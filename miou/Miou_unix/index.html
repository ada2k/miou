<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Miou_unix (miou.Miou_unix)</title><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">miou</a> &#x00BB; Miou_unix</nav><header class="odoc-preamble"><h1>Module <code><span>Miou_unix</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#the-unix-layer-of-miou.">The Unix layer of Miou.</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Cond"><a href="#module-Cond" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Cond/index.html">Cond</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Due to our scheduler, we must re-implement few things like &quot;Condition&quot; to be able to wait and signal (or broadcast) our tasks. The suspension of a task must always be notified to Miou. It is possible to use real <code>Condition</code>.t with Miou - however, some mechanisms such as cancellation will not work.</p></div></div><h2 id="the-unix-layer-of-miou."><a href="#the-unix-layer-of-miou." class="anchor"></a>The Unix layer of Miou.</h2><p>This module offers a re-implementation of the I/O according to Miou's model. In addition to managing possible suspensions due to I/O, the module also provides a notion of &quot;ownership&quot; which checks <i>at runtime</i> whether the task is able to perform I/O on the <a href="#type-file_descr"><code>file_descr</code></a> used. It also checks (again <i>at runtime</i>) that these <a href="#type-file_descr"><code>file_descr</code></a> have been released.</p><p>For more information, please read the <a href="../Miou/Ownership/index.html"><code>Miou.Ownership</code></a> module.</p><div class="odoc-spec"><div class="spec type anchored" id="type-file_descr"><a href="#type-file_descr" class="anchor"></a><code><span><span class="keyword">type</span> file_descr</span></code></div><div class="spec-doc"><p>Type of file-descriptors.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span>bytes <span class="arrow">&#45;&gt;</span></span> <span>off:int <span class="arrow">&#45;&gt;</span></span> <span>len:int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>read fd buf ~off ~len</code> reads <code>len</code> bytes from <code>fd</code> into <code>buf</code> starting at <code>off</code>. Return the number of bytes actually read.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>off:int <span class="arrow">&#45;&gt;</span></span> <span>len:int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write fd str ~off ~len</code> writes <code>len</code> bytes starting at <code>off</code> from <code>str</code> on <code>fd</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>connect fd sockaddr</code> is a Miou friendly <code>Unix</code>.connect. The function accepts only <a href="#type-file_descr"><code>file_descr</code></a>s in non-blocking mode.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-accept"><a href="#val-accept" class="anchor"></a><code><span><span class="keyword">val</span> accept : <span>?cloexec:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-file_descr">file_descr</a> * <span class="xref-unresolved">Unix</span>.sockaddr</span></code></div><div class="spec-doc"><p><code>accept ?cloexec fd</code> is a Miou friendly <code>Unix</code>.accept which returns file descritptors in non-blocking mode.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>close fd</code> closes and <a href="../Miou/Ownership/index.html#val-disown"><code>Miou.Ownership.disown</code></a> properly the given <code>fd</code>. Its use ensures that there is no leakage of resources.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sleep"><a href="#val-sleep" class="anchor"></a><code><span><span class="keyword">val</span> sleep : <span>float <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>sleep v</code> suspends the current task and <i>sleeps</i> <code>v</code> seconds.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_file_descr"><a href="#val-of_file_descr" class="anchor"></a><code><span><span class="keyword">val</span> of_file_descr : 
  <span>?non_blocking:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?owner:<a href="../Miou/Ownership/index.html#type-t">Miou.Ownership.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-file_descr">file_descr</a></span></code></div><div class="spec-doc"><p><code>of_file_descr ?non_blocking ?owner fd</code> creates a new <a href="#type-file_descr"><code>file_descr</code></a>. Depending on <code>non_blocking</code> (defaults to <code>true</code>), we set the given <code>fd</code> to non-blocking mode or not. The user can also specify the owner of the given <code>fd</code>. Otherwise, we consider the current task as the owner.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_file_descr"><a href="#val-to_file_descr" class="anchor"></a><code><span><span class="keyword">val</span> to_file_descr : <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Unix</span>.file_descr</span></code></div><div class="spec-doc"><p><code>to_file_descr fd</code> returns the <i>real</i> <code>Unix</code>.file_descr.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-owner"><a href="#val-owner" class="anchor"></a><code><span><span class="keyword">val</span> owner : <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Miou/Ownership/index.html#type-t">Miou.Ownership.t</a></span></code></div><div class="spec-doc"><p><code>owner fd</code> returns the witness of the task's ownership. It is useful to pass the ownership to a sub-task:</p><pre class="language-ocaml"><code>let fd = tcpv4 () in
let p0 = Miou.call_cc ~give:[ owner fd ] @@ fun () -&gt;
  connect fd addr; transfer fd in
Miou.await p0</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tcpv4"><a href="#val-tcpv4" class="anchor"></a><code><span><span class="keyword">val</span> tcpv4 : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-file_descr">file_descr</a></span></code></div><div class="spec-doc"><p><code>tcpv4 ()</code> allocates a new socket owned by the current task.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tcpv6"><a href="#val-tcpv6" class="anchor"></a><code><span><span class="keyword">val</span> tcpv6 : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-file_descr">file_descr</a></span></code></div><div class="spec-doc"><p><code>tcpv6 ()</code> allocates a new socket owned by the current task.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-transfer"><a href="#val-transfer" class="anchor"></a><code><span><span class="keyword">val</span> transfer : <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-file_descr">file_descr</a></span></code></div><div class="spec-doc"><p><code>transfer fd</code> transfers the ownership of <code>fd</code> into the parent of the current task.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disown"><a href="#val-disown" class="anchor"></a><code><span><span class="keyword">val</span> disown : <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>disown fd</code> informs Miou that the current task is not the owner of the given <code>fd</code> anymore. It's useful when you want to <i>pass</i> the given <code>fd</code> to another task.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind_and_listen"><a href="#val-bind_and_listen" class="anchor"></a><code><span><span class="keyword">val</span> bind_and_listen : <span>?backlog:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-file_descr">file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>bind_and_listen fd sockaddr</code> binds the given socket to the given <code>sockaddr</code> and set up the given <code>fd</code> for receiving connection requests. <code>backlog</code> is the maximal number of pending requests.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span>?g:<span class="xref-unresolved">Stdlib</span>.Random.State.t <span class="arrow">&#45;&gt;</span></span> <span>?domains:int <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div></div></div></body></html>